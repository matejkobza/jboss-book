<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	template="templates/template2columns.xhtml">

	<ui:define name="leftContent">
		<h1>#{msgs['reservations']}</h1>

		<h:outputText value="#{msgs['reservationState']}" />
		<p:selectOneMenu id="reservationState"
			value="#{reservationsBean.reservationState}">
			<f:selectItem itemLabel="#{msgs['all']}" itemValue="" />
			<f:selectItems value="#{reservationsBean.reservationStates}" />
			<p:ajax update="resultTable"
				listener="#{reservationsBean.handleReservationStateChange}" />
		</p:selectOneMenu>

		<p:dataTable var="reservation" id="resultTable"
			value="#{reservationsBean.reservations}" paginator="true" rows="50"
			style="width: 450px">
			<p:column sortBy="#{reservation.id}">
				<f:facet name="header">
					<h:outputText value="Id" />
				</f:facet>
				<h:outputText value="#{reservation.id}" />
			</p:column>
			<p:column sortBy="#{reservation.bookCopy.book.title}"
				filterBy="#{reservation.bookCopy.book.title}">
				<f:facet name="header">
					<h:outputText value="Book title" />
				</f:facet>
				<h:outputText value="#{reservation.bookCopy.book.title}" />
			</p:column>
			<p:column sortBy="#{reservation.bookCopy.purchaseDate}"
				filterBy="#{reservation.bookCopy.purchaseDate}">
				<f:facet name="header">
					<h:outputText value="Book copy purchase date" />
				</f:facet>
				<h:outputText value="#{reservation.bookCopy.purchaseDate}" />
			</p:column>
			<p:column sortBy="#{reservation.reservationState}"
				filterBy="#{reservation.reservationState}">
				<f:facet name="header">
					<h:outputText value="Reservation state" />
				</f:facet>
				<h:outputText value="#{reservation.reservationState}" />
			</p:column>
			<p:column sortBy="#{reservation.user.name}"
				filterBy="#{reservation.user.name}">
				<f:facet name="header">
					<h:outputText value="User" />
				</f:facet>
				<h:outputText value="#{reservation.user.name}" />
			</p:column>
			<p:column sortBy="#{reservation.user.username}"
				filterBy="#{reservation.user.username}">
				<f:facet name="header">
					<h:outputText value="Username" />
				</f:facet>
				<h:outputText value="#{reservation.user.username}" />
			</p:column>
			<p:column>
				<h:commandLink value="#{msgs['prepareBook']}"
					actionListener="#{reservationsBean.prepareBook(reservation.id)}"
					rendered="#{reservation.reservationState == 'NEW'}" />
				<h:commandLink value="#{msgs['lendBook']}"
					actionListener="#{reservationsBean.lendBook(reservation.id)}"
					rendered="#{reservation.reservationState == 'READY'}" />
				<h:commandLink value="#{msgs['returnBook']}"
					actionListener="#{reservationsBean.returnBook(reservation.id)}"
					rendered="#{reservation.reservationState == 'LENT'}" />
			</p:column>
		</p:dataTable>
	</ui:define>

</ui:composition>
</html>